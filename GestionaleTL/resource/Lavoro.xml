<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
 <mapper namespace="it.exolab.gestionaleTL.mapper.LavoroMapper">
  
  
  	<insert id = "insert"
		parameterType="it.exolab.gestionaleTL.model.Lavoro" 
		useGeneratedKeys="true" keyProperty="id" keyColumn="id">
		   insert into user (nome, esito_voto, stato, id_riunione) values ( 
		   #{nome}, 
		   #{esito_voto}, 
		   #{stato}, 
		   #{id_riunione} )
		   
	</insert>
  
  	<select id="find" parameterType="Integer" resultMap="lavoromap">
		SELECT
		l.id AS lavoro_id, l.nome AS lavoro_nome, 
		l.esito_voto AS lavoro_esito_voto, l.stato AS lavoro_stato,
		d.id AS documentazione_id, d.nome AS documentazione_nome, 
		d.costo AS documentazione_costo, d.`societ√†` AS documentazione_societa,
		v.id AS votazione_id, v.voto AS votazione_voto
		FROM lavoro AS l
		INNER JOIN documentazione AS d on l.id = d.id_lavoro
		inner join votazione AS v on d.id = v.id_documentazione
		WHERE l.id = ${id};
	 
	</select>

		
	 <resultMap id="lavoromap" type="it.exolab.gestionaleTL.model.Lavoro">
	  
	    <result property="id" column="documentazione_id"/>
	    <result property="nome" column="documentazione_nome" />
	    <result property="esito_voto" column="lavoro_esito_voto" />
	    <result property="stato" column="lavoro_stato"/>
	  
	  <association property="listaDocumenti" javaType="it.exolab.gestionaleTL.model.Documentazione">
	  
	    <result property="id" column="documentazione_id"/>
	    <result property="costo" column="documentazione_costo"/>
	    <result property="nome" column="documentazione_nome"/>
	    <result property="societa" column="documentazione_societa"/>
	    
	    
	    <association property="listaVoti" javaType="it.exolab.gestionaleTL.model.Votazione">
	  
	    <result property="id" column="votazione_id"/>
	    <result property="voto" column="votazione_voto"/>
	    
	 	</association>
	    
	  </association>
	  
	  

	</resultMap>
</mapper>